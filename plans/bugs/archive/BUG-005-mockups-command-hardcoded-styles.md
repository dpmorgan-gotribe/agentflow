# BUG-005: Mockups Command Hardcoded to 3 Styles

## Problem
The mockups command is hardcoded to generate 3 styles (style-1, style-2, style-3) regardless of how many styles were generated during the analyze phase. Running `agentflow analyze 5` creates 5 styles but `agentflow mockups` only generates 3 mockups with wrong numbering (1-indexed instead of 0-indexed).

## Context
- **Affected Command**: `agentflow mockups`
- **Affected File**: `src/commands/mockups.ts`
- **Related to**: BUG-004 (analyze now supports dynamic style counts)

## Root Cause
The mockups.ts file has a hardcoded array:
```typescript
const styles = [
  { id: 'style-1', name: 'Wireframe Faithful', description: '...' },
  { id: 'style-2', name: 'Modern', description: '...' },
  { id: 'style-3', name: 'Bold', description: '...' }
];
```

This ignores:
1. The actual number of styles generated by analyze
2. The new 0-indexed style convention (Style 0 = user's vision)
3. The assets/styles/style-N/ directories created by analyze

## Implementation Steps

### 1. Update mockups.ts to detect style count dynamically
- Read `assets/styles/` directory to count style-N folders
- Fallback: Parse styles.md for `## Style N:` headers
- Use 0-indexed style numbering (style-0, style-1, etc.)

### 2. Update worker task generation
- Create one worker per detected style
- Pass style-specific section from styles.md to each worker
- Include inspirations.md for design guidance

### 3. Update output messages
- Show correct style list in completion message
- Use dynamic style count in "Next:" instructions

## Code Changes

**File**: `src/commands/mockups.ts`

```typescript
import { readFile, writeFile, mkdir, readdir } from 'fs/promises';
import { join } from 'path';
import { loadSystemPrompt, loadSkill } from '../lib/agent.js';
import { runWorkersParallel } from '../lib/worker.js';

export async function mockups() {
  const projectDir = process.cwd();

  // Load analysis outputs
  let stylesContent: string;
  let componentsContent: string;
  let inspirationsContent: string;
  try {
    stylesContent = await readFile(join(projectDir, 'outputs', 'analysis', 'styles.md'), 'utf-8');
    componentsContent = await readFile(join(projectDir, 'outputs', 'analysis', 'components.md'), 'utf-8');
    inspirationsContent = await readFile(join(projectDir, 'outputs', 'analysis', 'inspirations.md'), 'utf-8');
  } catch {
    console.error('Analysis outputs not found. Run `agentflow analyze` first.');
    process.exit(1);
  }

  // Detect style count from assets/styles/ directories
  let styleCount = 1;
  try {
    const stylesDir = join(projectDir, 'assets', 'styles');
    const dirs = await readdir(stylesDir);
    const styleDirs = dirs.filter(d => d.startsWith('style-'));
    styleCount = styleDirs.length;
  } catch {
    // Fallback: parse styles.md
    const styleMatches = stylesContent.match(/## Style \d+:/g);
    if (styleMatches) styleCount = styleMatches.length;
  }

  console.log(`Generating ${styleCount} mockup(s)...`);

  // Load skill and system prompt
  const systemPrompt = await loadSystemPrompt(projectDir, 'ui-designer');
  const skill = await loadSkill(projectDir, 'design/design-mockup');

  // Create worker tasks (one per style: 0, 1, 2, ...)
  const workerTasks = [];
  for (let i = 0; i < styleCount; i++) {
    workerTasks.push({
      id: `style-${i}`,
      systemPrompt: `${systemPrompt}\n\n## Skill\n\n${skill}`,
      userPrompt: `Create a mockup for Style ${i}.

## Style Definitions
${stylesContent}

## Components Available
${componentsContent}

## Design Inspirations
${inspirationsContent}

## Instructions
- Find "## Style ${i}:" in the style definitions above
- Create an HTML mockup demonstrating this style
- Use the colors, typography, and spacing from Style ${i}`
    });
  }

  // Run workers in parallel
  const results = await runWorkersParallel(workerTasks);

  // Write outputs
  const outputDir = join(projectDir, 'outputs', 'mockups');
  await mkdir(outputDir, { recursive: true });

  for (const result of results) {
    if (result.output) {
      await writeFile(join(outputDir, `${result.id}.html`), result.output);
    }
  }

  const styleList = Array.from({ length: styleCount }, (_, i) => `  - style-${i}.html`).join('\n');
  console.log(`\nStyle mockups complete!\n\nOutputs:\n${styleList}\n\nNext: agentflow stylesheet --style=N`);
}
```

## Testing

- [ ] `agentflow analyze 1` then `agentflow mockups` → generates style-0.html only
- [ ] `agentflow analyze 3` then `agentflow mockups` → generates style-0, style-1, style-2
- [ ] `agentflow analyze 5` then `agentflow mockups` → generates style-0 through style-4
- [ ] Mockups reference correct style definitions from styles.md

## Rollback Plan

1. Revert mockups.ts to hardcoded 3-style version
2. `npm run build`
